{"version":3,"sources":["webpack:///./src/views/Login.vue?a040","webpack:///src/views/Login.vue","webpack:///./src/views/Login.vue?3a4e","webpack:///./src/views/Login.vue","webpack:///./src/views/Login.vue?b712"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","ref","model","value","callback","$$v","valid","expression","nameRules","username","passwordRules","on","$event","type","indexOf","_k","keyCode","key","submitHandler","password","pending","_s","staticRenderFns","components","Navbar","data","computed","methods","validate","$refs","form","mounted","cart","JSON","parse","window","localStorage","getItem","beforeRouteEnter","next","vm","prevRoute","from","component","VApp","VBtn","VContainer","VForm","VTextField"],"mappings":"8GAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,QAAQ,CAACE,YAAY,cAAcC,MAAM,CAAC,IAAM,KAAK,CAACH,EAAG,UAAUA,EAAG,cAAc,CAACE,YAAY,yDAAyD,CAACF,EAAG,KAAK,CAACE,YAAY,eAAe,CAACN,EAAIQ,GAAG,QAAQJ,EAAG,SAAS,CAACK,IAAI,OAAOH,YAAY,aAAaC,MAAM,CAAC,kBAAkB,IAAIG,MAAM,CAACC,MAAOX,EAAS,MAAEY,SAAS,SAAUC,GAAMb,EAAIc,MAAMD,GAAKE,WAAW,UAAU,CAACX,EAAG,eAAe,CAACG,MAAM,CAAC,MAAQP,EAAIgB,UAAU,MAAQ,UAAU,mBAAmB,GAAG,SAAW,GAAG,UAAY,GAAG,SAAW,IAAIN,MAAM,CAACC,MAAOX,EAAY,SAAEY,SAAS,SAAUC,GAAMb,EAAIiB,SAASJ,GAAKE,WAAW,cAAcX,EAAG,eAAe,CAACG,MAAM,CAAC,MAAQP,EAAIkB,cAAc,MAAQ,UAAU,mBAAmB,GAAG,KAAO,WAAW,SAAW,GAAG,UAAY,GAAG,SAAW,IAAIC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAIA,EAAOC,KAAKC,QAAQ,QAAQtB,EAAIuB,GAAGH,EAAOI,QAAQ,QAAQ,GAAGJ,EAAOK,IAAI,SAAkB,KAAczB,EAAI0B,cAAcN,KAAUV,MAAM,CAACC,MAAOX,EAAY,SAAEY,SAAS,SAAUC,GAAMb,EAAI2B,SAASd,GAAKE,WAAW,cAAcX,EAAG,QAAQ,CAACE,YAAY,UAAUC,MAAM,CAAC,SAAWP,EAAI4B,QAAQ,MAAQ,UAAU,MAAQ,OAAO,OAAS,QAAQT,GAAG,CAAC,MAAQnB,EAAI0B,gBAAgB,CAAC1B,EAAIQ,GAAG,IAAIR,EAAI6B,GAAG7B,EAAI4B,QAAU,MAAQ,MAAM,QAAQ,IAAI,IAAI,IACvyCE,EAAkB,G,sGCyDtB,GACEC,WAAY,CACVC,OAAJ,QAEEC,KAAM,WAAR,OACA,SACA,YACA,YACA,WACA,mCAEA,eACA,iCAEA,aACA,QACA,aAEEC,SAAU,OAAZ,OAAY,CAAZ,GACA,+CAGEC,QAAS,CACPC,SADJ,WAEMnC,KAAKoC,MAAMC,KAAKF,YAElB,cAJJ,WAIA,kKACA,wBADA,wBAEA,aAFA,kBAIA,gBACA,oBACA,sBANA,OAIA,EAJA,OAQA,gBACA,qCACA,iLACA,OADA,qDAEA,UAFA,gBAGA,gLACA,oEACA,EAFA,gCAGA,eACA,qCACA,4CALA,6CAQA,+DARA,kGAHA,sCAeA,kDAfA,OAiBA,sCAjBA,4CAmBA,aACA,0CACA,iBACA,2BACA,4CAEA,sBAGA,aACA,SACA,aACA,wBAzCA,mDA6CA,aACA,kBACA,SACA,aACA,aACA,kCAlDA,6DAwDEG,QAlFF,WAmFItC,KAAKuC,KAAOC,KAAKC,MAAMC,OAAOC,aAAaC,QAAQ,gBAErDC,iBArFF,SAqFA,OACIC,GAAK,SAAT,GACMC,EAAGC,UAAYC,OCjJ0T,I,yGCQ3UC,EAAY,eACd,EACApD,EACA+B,GACA,EACA,KACA,KACA,MAIa,aAAAqB,EAAiB,QAShC,IAAkBA,EAAW,CAACC,OAAA,KAAKC,OAAA,KAAKC,aAAA,KAAWC,QAAA,KAAMC,aAAA,Q,kCC5BzD,W","file":"js/Login.fad58198.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',{staticClass:\"home vh-100\",attrs:{\"app\":\"\"}},[_c('Navbar'),_c('v-container',{staticClass:\"d-flex justify-center align-center flex-column vh-100\"},[_c('h3',{staticClass:\"login mb-10\"},[_vm._v(\"登入\")]),_c('v-form',{ref:\"form\",staticClass:\"form-width\",attrs:{\"lazy-validation\":\"\"},model:{value:(_vm.valid),callback:function ($$v) {_vm.valid=$$v},expression:\"valid\"}},[_c('v-text-field',{attrs:{\"rules\":_vm.nameRules,\"label\":\"請輸入你的帳號\",\"validate-on-blur\":\"\",\"outlined\":\"\",\"clearable\":\"\",\"required\":\"\"},model:{value:(_vm.username),callback:function ($$v) {_vm.username=$$v},expression:\"username\"}}),_c('v-text-field',{attrs:{\"rules\":_vm.passwordRules,\"label\":\"請輸入你的密碼\",\"validate-on-blur\":\"\",\"type\":\"password\",\"outlined\":\"\",\"clearable\":\"\",\"required\":\"\"},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.submitHandler($event)}},model:{value:(_vm.password),callback:function ($$v) {_vm.password=$$v},expression:\"password\"}}),_c('v-btn',{staticClass:\"ma-auto\",attrs:{\"disabled\":_vm.pending,\"color\":\"primary\",\"width\":\"100%\",\"height\":\"50px\"},on:{\"click\":_vm.submitHandler}},[_vm._v(\" \"+_vm._s(_vm.pending ? '登入中' : '送出')+\" \")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-app app class=\"home vh-100\">\n    <Navbar />\n    <v-container class=\"d-flex justify-center align-center flex-column vh-100\">\n        <h3 class=\"login mb-10\">登入</h3>\n        <v-form\n          class=\"form-width\"\n          ref=\"form\"\n          v-model=\"valid\"\n          lazy-validation\n        >\n          <v-text-field\n            v-model=\"username\"\n            :rules=\"nameRules\"\n            label=\"請輸入你的帳號\"\n            validate-on-blur\n            outlined\n            clearable\n            required\n          ></v-text-field>\n\n          <v-text-field\n            v-model=\"password\"\n            @keyup.enter=\"submitHandler\"\n            :rules=\"passwordRules\"\n            label=\"請輸入你的密碼\"\n            validate-on-blur\n            type=\"password\"\n            outlined\n            clearable\n            required\n          ></v-text-field>\n\n          <v-btn\n            :disabled=\"pending\"\n            color=\"primary\"\n            class=\"ma-auto\"\n            width=\"100%\"\n            height=\"50px\"\n            @click=\"submitHandler\"\n          >\n            {{ pending ? '登入中' : '送出' }}\n          </v-btn>\n          <!-- <v-progress-circular\n            v-if=\"pending\"\n            :width=\"5\"\n            color=\"primary\"\n            indeterminate\n          ></v-progress-circular> -->\n        </v-form>\n    </v-container>\n  </v-app>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport { login, postOrder, pushOrder, editOrder } from '../apis/user.js'\nimport Navbar from '../components/Navbar.vue'\nexport default {\n  components: {\n    Navbar\n  },\n  data: () => ({\n    valid: true,\n    username: '',\n    password: '',\n    nameRules: [\n      v => !!v || '帳號名稱為必填'\n    ],\n    passwordRules: [\n      v => !!v || '密碼為必填'\n    ],\n    prevRoute: '',\n    cart: [],\n    pending: false\n  }),\n  computed: {\n    ...mapState(['user', 'orderId', 'cartList'])\n  },\n\n  methods: {\n    validate () {\n      this.$refs.form.validate()\n    },\n    async submitHandler () {\n      if (this.$refs.form.validate()) {\n        this.pending = true\n        try {\n          const res = await login({\n            username: this.username,\n            password: this.password\n          })\n          if (res.data.success) {\n            this.$store.commit('login', res.data.user)\n            this.$store.dispatch('fetchCartList').then(async () => {\n              if (!this.cart) return\n              if (this.orderId) {\n                this.cart.forEach(async item => {\n                  const alreadyInCart = this.cartList.find(el => el.productId === item.productId)\n                  if (alreadyInCart) {\n                    await editOrder(\n                      { userId: this.user.id, orderId: this.orderId }\n                      , { quantity: item.quantity + alreadyInCart.quantity, pId: alreadyInCart._id }\n                    )\n                  } else {\n                    await pushOrder({ userId: this.user.id, orderId: this.orderId }, { order: item })\n                  }\n                })\n              } else {\n                await postOrder({ userId: this.user.id }, { order: this.cart })\n              }\n              localStorage.removeItem('hiker-cart')\n            })\n            this.pending = false\n            if (this.prevRoute && this.prevRoute.params.productId) {\n              this.$router.go(-1)\n            } else if (res.data.user.role === 'admin') {\n              this.$router.push('/admin/product-management')\n            } else {\n              this.$router.push('/')\n            }\n          } else {\n            this.pending = false\n            this.$swal({\n              icon: 'error',\n              title: res.data.message\n            })\n          }\n        } catch (err) {\n          this.pending = false\n          console.log(err)\n          this.$swal({\n            icon: 'error',\n            title: '發生錯誤',\n            text: err.response.data.message\n          })\n        }\n      }\n    }\n  },\n  mounted () {\n    this.cart = JSON.parse(window.localStorage.getItem('hiker-cart'))\n  },\n  beforeRouteEnter (to, from, next) {\n    next(vm => {\n      vm.prevRoute = from\n    })\n  }\n}\n</script>\n\n<style>\n.login{\n  font-size: 2.3rem;\n  color: var(--v-primary-base);\n}\n.vh-100{\n  height: 100vh;\n}\n.form-width{\n  width: 300px;\n}\n@media (min-width: 768px) {\n  .form-width{\n    width: 380px;\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Login.vue?vue&type=template&id=6bc7d2da&\"\nimport script from \"./Login.vue?vue&type=script&lang=js&\"\nexport * from \"./Login.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Login.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VForm } from 'vuetify/lib/components/VForm';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VApp,VBtn,VContainer,VForm,VTextField})\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}